<!DOCTYPE html>
<html>
<script src="https://d3js.org/d3.v4.js"></script>
<script src="data.js"></script>
<body>
<h2>Gender Ratio of Newborns in China</h2>

<svg id="myPlot" style="width:700px;height:500px"></svg>
<div id="myPlot"></div>


<script>
// Set Dimensionss


const margin = 40;
const xSize = 700; 
const ySize = 500;
const xMax = xSize-margin*2;
const yMax = ySize-margin*2;


// Append SVG Object to the Page
const svg = d3.select("#myPlot")
  .append("svg")
  .append("g")
  .attr("transform","translate(" + margin + "," + margin + ")");

// X Axis
const xScale = d3.scaleLinear()
  .domain([0, 100000])
  .range([0, xMax]);

svg.append("g")
  .attr("transform", "translate(0," + yMax + ")")
  .call(d3.axisBottom(xScale))
  .attr("class", "x axis");

// Y Axis
const yScale = d3.scaleLinear()
  .domain([80, 130])
  .range([yMax,0]);

svg.append("g")
  .call(d3.axisLeft(yScale));

var line = d3.line()
  .x(function(d) { return xScale(d[0]); })
  .y(function(d) { return yScale(3471.15219/d[0]+131.557136-2.08313543*Math.log(d[0])); });

/*
//Line
svg.append("path")
  .datum(boundary) // binds data to the line 
  .attr("d", line) // calls the line generator 
  .attr("stroke", "blue")
  .attr("stroke-width", 2)
  .attr("fill", "none");
*/

// Area, const data=boundary
var area = d3.area()
  .x(function(d) { return xScale(d[0]); })
  .y0(function(d) { return yScale(d[1]); })
  .y1(function(d) { return yScale(d[2]); })
  .curve(d3.curveBasis);

svg.append("path")
  .datum(boundary)
  .attr("fill", "gray")
  .attr("fill-opacity", 0.2)
  .attr("d", area);

// create a tooltip
var Tooltip = d3.select("body")
    .append("div")
    .style("opacity", 0)
    .style("visibility", "visible")
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px")
    .style("z-index", "10")
    .style("width", "auto")  // set width
    .style("height", "auto")
    .style("position", "absolute")   

// Three function that change the tooltip when user hover / move / leave a cell
var mouseover = function(d) {
    Tooltip
      .style("opacity", 1)
    d3.select(this)
      .attr("r", 10)
  }
var mousemove = function(d) {
    Tooltip
      .html(`District: ${d.District} <br> Total number of Newborns: ${d.Number_total} <br> Gender Ratio: ${d.Ratio_total}`)
      .style("left", (d3.event.pageX+10) + "px")
      .style("top", (d3.event.pageY) + "px")
  }
var mouseleave = function(d) {
    Tooltip
      .style("opacity", 0)
    d3.select(this)
      .attr("r", 5)
  }

// Build color scale
var colorScale = d3.scaleLinear()
    .domain([0, 10])
    .range(["yellow", "red"]);

//Dots
svg.selectAll("circle")
  .data(data)
  .enter()
  .append("circle")
    .attr("cx", function (d) { return xScale(d.Number_total)} )
    .attr("cy", function (d) { return yScale(d.Ratio_total)} )
    .attr("r", 5)
    .style("stroke", "black")

    //if dot is above line, fill the dot with color scale, else fill with green
    .style("fill", function(d) {
    if (yScale(d.Ratio_total) < yScale(3471.15219/d.Number_total+131.557136-2.08313543*Math.log(d.Number_total)))
     {return colorScale(d.Ratio_total-((3471.15219/d.Number_total+131.557136-2.08313543*Math.log(d.Number_total))));} 
    else {return d3.rgb("green").brighter(1); }
  })
  .on("mouseover", mouseover)
  .on("mousemove", mousemove)
  .on("mouseleave", mouseleave);
  
svg.append("text")             
    .attr("x", 500)             
    .attr("y", 410)    
    .style("text-anchor", "middle")  
    .text("Number of newborns in 2020 census year");

svg.append("text")             
    .attr("x", 80)             
    .attr("y", 0)    
    .style("text-anchor", "middle")  
    .text("Gender ratio / %");

// Create the text labels
svg.selectAll(".text")
    .append("text")
    .attr("x", xScale(250))
    .attr("y", yScale(25))
    .text(`Gender Ratio/%`)
    .attr("font-size", "12px")
    //.attr("dx", "6px") // Offsets by 6px to the right of dot
    //.attr("dy", ".35em"); // Vertically centers text

</script>

</body>
</html>
